<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.fourth.tuna.domain.user.mapper.StudentMapper">


<select id = "findById" 
	parameterType="co.fourth.tuna.domain.user.vo.StudentVO" resultType="co.fourth.tuna.domain.user.vo.StudentVO">
	select* from student where no = #{no}
</select>

<select id = "findByUserId" parameterType="co.fourth.tuna.domain.user.vo.StudentVO" resultType="co.fourth.tuna.domain.user.vo.StudentVO">
	select* from login where no = #{no}
</select>


<update id = "studUpdate" parameterType="co.fourth.tuna.domain.user.vo.StudentVO">
	<selectKey resultType="String" keyProperty="bacc" order="BEFORE">
		select no bacc
		from publiccode
		where codename = #{bacc}
	</selectKey>

	update student 
	set tel = #{tel}, email = #{email}, zip = #{zip}, addr = #{addr}, bacc = #{bacc}, bank = #{bank}
	where no = #{no}

</update>

<select id="findOneById"
	resultType="co.fourth.tuna.domain.user.vo.StudentVO">
	SELECT *
	FROM student
	WHERE no = #{no}
</select>

<update id = "AdminStudUpdate" 
	parameterType="co.fourth.tuna.domain.user.vo.StudentVO">
	update student
	set DEPTCODE = #{deptCode}, NAME = #{name}, STATECODE = #{stateCode}
	WHERE no = #{no}

</update>
 
<select id = "findListBySubjectId"
	resultType="co.fourth.tuna.domain.user.vo.StudentExVO">
	SELECT s.*,
		(<include refid="co.fourth.tuna.domain.common.mapper.CodeMapper.findCodeNameSql">
			<property name="no" value="statecode" />
		</include>) AS statename,
		(<include refid="co.fourth.tuna.domain.common.mapper.CodeMapper.findCodeNameSql">
			<property name="no" value="bacc" />
		</include>) AS bankname,
		(<include refid="co.fourth.tuna.domain.common.mapper.CodeMapper.findCodeNameSql">
			<property name="no" value="deptcode" />
		</include>) AS deptname
	FROM student s
	JOIN lectureapply l
	    ON s.no = l.stno
	WHERE sbjno = #{sbjno}
</select>

<update id="studPwdUpdate" parameterType="co.fourth.tuna.domain.user.vo.StudentVO">

update student set pwd = #{pwd} where no = #{no}

</update>

<select id = "findStudPwd" parameterType="co.fourth.tuna.domain.user.vo.StudentVO" resultType="String">

select pwd from student where no = #{no}

</select>

<select id = "findEmail" parameterType="co.fourth.tuna.domain.user.vo.StudentVO" resultType="boolean">

SELECT case when count(*) >= 1 then 1 else 0 end as truefalse
 from student
 where email = #{email}

</select>

<update id = "studEamilPwdUpdate" parameterType="co.fourth.tuna.domain.user.vo.StudentVO">

update student set pwd = #{pwd} where email = #{email}

</update>


</mapper>