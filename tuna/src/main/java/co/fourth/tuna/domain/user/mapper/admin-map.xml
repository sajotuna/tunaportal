<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.fourth.tuna.domain.user.mapper.AdminMapper">

<select id = "findById" parameterType = "co.fourth.tuna.domain.user.vo.AdminVO" resultType = "co.fourth.tuna.domain.user.vo.AdminVO">
	select* from admin where no = #{no}
</select>

<select id ="adminUserCheck" parameterType="map" resultType="map">
SELECT u.*,ROWNUM
FROM
    (SELECT LOGIN.* FROM
        (SELECT S2.NO, S2.NAME, S2.STATECODE, S2.SY, (SELECT  NVL(ROUND(SUM((CASE  WHEN G.TOTAL BETWEEN 95 AND 100 THEN 4.5
                                WHEN G.TOTAL >= 90                       THEN 4.0
                                WHEN G.TOTAL >= 85                       THEN 3.5
                                WHEN G.TOTAL >= 80                       THEN 3.0
                                WHEN G.TOTAL >= 75                       THEN 2.5
                                WHEN G.TOTAL >= 70                       THEN 2.0
                                WHEN G.TOTAL >= 65                       THEN 1.5
                                WHEN G.TOTAL BETWEEN 60 AND 64  THEN 1.0
                                ELSE 0 END ) * S.POINT) / SUM(S.POINT),2),0) AS TOTAL
            FROM GRADE G, SUBJECT S 
            WHERE S.SEASONCODE = 105 AND S.NO = G.SBJNO AND STNO = S2.NO) AS AVGSCORE, S2.DEPTCODE, S2.ENTERDATE
        FROM STUDENT S2
        WHERE NO IN (SELECT NO FROM STUDENT)
        UNION
        SELECT NO, NAME, STATECODE, NULL, NULL, DEPTCODE, HIREDATE
    FROM PROFESSOR
    ) LOGIN) u
WHERE ROWNUM 
BETWEEN (#{pageNum}-1)*#{size}+1
    AND #{pageNum}*#{size}
    <if test="startDate != null and !startDate.equals('') and endDate != null and !endDate.equals('')">
      AND u.ENTERDATE BETWEEN TO_DATE(#{startDate},'rrrr-MM-dd') AND TO_DATE(#{endDate},'rrrr-MM-dd')
      </if>
    <if test="deptCode != null and !deptCode.equals('')">
    AND u.DEPTCODE = #{deptCode}
    </if>
    <if test="statecode != null and !statecode.equals('')">
    AND u.STATECODE = #{statecode}
    </if>
    <if test="no != null and !no.equals('')">
    AND u.no = #{no}
    </if>
     

</select>

<update id = "adminEamilPwdUpdate" parameterType="co.fourth.tuna.domain.user.vo.AdminVO">

update admin set pwd = #{pwd} where email = #{email}

</update>

<update id = "adminInfoUpdate" parameterType="co.fourth.tuna.domain.user.vo.AdminVO">

update admin set tel = #{tel}, email = #{email}, zip = #{zip}, addr = #{addr}
	where no = #{no}

</update>

<update id = "adminpwdUpdate" parameterType="co.fourth.tuna.domain.user.vo.AdminVO">

update admin set pwd = #{pwd} where no = #{no}

</update>

<select id = "adminPwdFind" parameterType="co.fourth.tuna.domain.user.vo.AdminVO" resultType="String">

select pwd from admin where no = #{no}

</select>

<select id = "findEmail" parameterType="co.fourth.tuna.domain.user.vo.AdminVO" resultType = "boolean">

SELECT case when count(*) >= 1 then 1 else 0 end as truefalse
 from admin
 where email = #{email}

</select>

<select id = "AdminUserCount" resultType="int">
	select count(*) from userSelect
</select>



</mapper>