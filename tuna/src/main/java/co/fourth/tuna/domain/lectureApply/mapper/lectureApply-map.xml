<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="co.fourth.tuna.domain.lectureApply.mapper.LectureApplyMapper">

<select id="SubjectFind" resultType="map" parameterType="co.fourth.tuna.domain.lectureApply.vo.LectureApplyVO">

SELECT *
		FROM (
	    SELECT DISTINCT 
        ROWNUM      rn,
       S.NO         NO, 
       S.NAME       NAME, 
       S.TARGET     TARGET, 
       S.POINT      POINT, 
       S.LIMIT      LIMIT, 
       S.TYPE       TYPE, 
	   S.DEPTCODE   DEPTCODE ,
	   S.SEASONCODE SEASONCODE,
	   
       P.NAME       PRONAME,
        
	   L.ROOMCODE   ROOMCODE, 
	   LISTAGG(L.TIMECODE, ' ') WITHIN GROUP (ORDER BY L.TIMECODE)  OVER (PARTITION BY S.NO) AS TIMECODE,
       LISTAGG(L.DAYCODE, '/') WITHIN GROUP (ORDER BY L.DAYCODE DESC)  OVER (PARTITION BY S.NO) AS   DAYCODE
  FROM SUBJECT S, LECTURESCHEDULE L, PROFESSOR P
  WHERE S.NO = L.SBJNO 
   AND S.PFNO = P.NO AND S.NO IN ( SELECT NO FROM SUBJECT)
	) WHERE rn 
			BETWEEN (#{pageNum}-1)*#{size}
   		AND #{pageNum}*#{size}

</select>

<select id ="CourseFind" resultType="map" parameterType="co.fourth.tuna.domain.lectureApply.vo.LectureApplyVO">
SELECT DISTINCT 
       S.NO         NO, 
       S.NAME       NAME, 
       S.TARGET     TARGET, 
       S.POINT      POINT, 
       S.LIMIT      LIMIT, 
       S.TYPE       TYPE, 
	   S.DEPTCODE   DEPTCODE ,
	   S.SEASONCODE SEASONCODE,
	   
       P.NAME       PRONAME,
        
	   L.ROOMCODE   ROOMCODE, 
	   LISTAGG(L.TIMECODE, ' ') WITHIN GROUP (ORDER BY L.TIMECODE)  OVER (PARTITION BY S.NO) AS TIMECODE,
       LISTAGG(L.DAYCODE, '/') WITHIN GROUP (ORDER BY L.DAYCODE DESC)  OVER (PARTITION BY S.NO) AS   DAYCODE
  FROM SUBJECT S, LECTURESCHEDULE L, PROFESSOR P, STUDENT S2, LECTUREAPPLY L2
 WHERE S.NO = L.SBJNO 
   AND S.PFNO = P.NO 
   AND S2.NO = L2.STNO 
   AND L2.SBJNO = S.NO
   AND S.NO IN ( SELECT NO FROM SUBJECT)
   AND STNO = #{STNO}
</select>

<select id = "CourseBasket" resultType="map" parameterType="co.fourth.tuna.domain.lectureApply.vo.LectureApplyVO">

SELECT DISTINCT 
       S.NO         NO, 
       S.NAME       NAME, 
       S.TARGET     TARGET, 
       S.POINT      POINT, 
       S.LIMIT      LIMIT, 
       S.TYPE       TYPE, 
	   S.DEPTCODE   DEPTCODE ,
	   S.SEASONCODE SEASONCODE,
	   
       P.NAME       PRONAME,
        
	   L.ROOMCODE   ROOMCODE, 
	   LISTAGG(L.TIMECODE, ' ') WITHIN GROUP (ORDER BY L.TIMECODE)  OVER (PARTITION BY S.NO) AS TIMECODE,
       LISTAGG(L.DAYCODE, '/') WITHIN GROUP (ORDER BY L.DAYCODE DESC)  OVER (PARTITION BY S.NO) AS   DAYCODE
  FROM SUBJECT S, LECTURESCHEDULE L, PROFESSOR P, STUDENT S2, LECTUREBASKET L2
 WHERE S.NO = L.SBJNO 
   AND S.PFNO = P.NO 
   AND S2.NO = L2.STNO 
   AND L2.SBJNO = S.NO 
   AND S.NO IN ( SELECT NO FROM SUBJECT)
   AND STNO = #{STNO}

</select>

</mapper>