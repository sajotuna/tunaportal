<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.fourth.tuna.domain.grade.mapper.GradeMapper">

	<!-- 당해학기 성적 조회 -->
	<select id="currentSemesterGradeSelect" resultType="map">
	
		SELECT S.SEASONCODE,
		       S.TYPE,
		       S.NO,
		       S.NAME,
               P.NAME AS PFNAME,
		       S.POINT,
		       S.PFNO,
		       GRADETOALPHABET(G.TOTAL) AS ALPHABET, 
		       GRADETOPOINT(G.TOTAL) AS TOTAL,
		       LE.EVALSTATE
		FROM LECTUREAPPLY LA, SUBJECT S, GRADE G, LECTUREEVAL LE, PROFESSOR P
		WHERE LA.SBJNO = S.NO
		AND LA.SBJNO = G.SBJNO
		AND LA.SBJNO = LE.SBJNO
        AND S.PFNO = P.NO
		AND LA.STNO = ${stNo}
		AND LA.SEASONCODE = ${seasonCode}
	
	</select>
	
	<select id="currentSemesterGradeTotal" resultType="map">
		
		SELECT COUNT(*) AS COUNT,
		       SUM(S.POINT) AS SUM, 
		       AVG(GRADETOPOINT(G.TOTAL)) AS AVG
		FROM GRADE G, SUBJECT S
		WHERE G.SBJNO = S.NO
		AND STNO = ${stNo}
		AND S.SEASONCODE = ${seasonCode}
	
	</select>
	<!-- END 당해학기 성적 조회 -->
	
	<!-- 보관 성적 조회 -->
	<select id="subjectGradeSelect" resultType="map">
	
		SELECT PS.CODENAME AS SEASONCODE,
      		   PT.CODENAME AS TYPENAME,
      		   S.TYPE,
		       S.NO,
		       S.NAME,
		       S.POINT,
		       GRADETOALPHABET(G.TOTAL) AS ALPHABET, 
		       GRADETOPOINT(G.TOTAL) AS TOTAL
		FROM GRADE G, SUBJECT S, PUBLICCODE PS, PUBLICCODE PT
		WHERE G.SBJNO = S.NO
		AND S.SEASONCODE = PS.NO
		AND S.TYPE = PT.NO
		AND STNO = ${stNo}
		ORDER BY SBJNO
		
	</select>
	
	<select id="seasonSubjectGradeSelect" resultType="map">
	
		SELECT PS.CODENAME AS SEASONCODE,
      		   PT.CODENAME AS TYPENAME,
      		   S.TYPE,
		       S.NO,
		       S.NAME,
		       S.POINT,
		       GRADETOALPHABET(G.TOTAL) AS ALPHABET, 
		       GRADETOPOINT(G.TOTAL) AS TOTAL
		FROM GRADE G, SUBJECT S, PUBLICCODE PS, PUBLICCODE PT
		WHERE G.SBJNO = S.NO
		AND S.SEASONCODE = PS.NO
		AND S.TYPE = PT.NO
		AND STNO = ${stNo}
		AND S.SEASONCODE = ${seasonCode}
		ORDER BY SBJNO
		
	</select>
	
	<select id="avgGradeSelect" resultType="map">
	
		SELECT (SELECT CODENAME FROM PUBLICCODE P WHERE S.SEASONCODE = P.NO) AS SEASONCODE, 
				SUM(S.POINT) AS SUM, 
				AVG(GRADETOPOINT(G.TOTAL)) AS AVG
		FROM GRADE G, SUBJECT S
		WHERE G.SBJNO = S.NO
		AND STNO = ${stNo}
		GROUP BY S.SEASONCODE
		ORDER BY S.SEASONCODE ASC
			
	</select>
	<!-- END 보관 성적 조회 -->

</mapper>