<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="co.fourth.tuna.domain.portalNotice.mapper.PortalNoticeMapper">
	
	
<!-- 공지 -->
<!-- 전체조회 -->
<select id="noticeList"
	resultType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeVO"> 
SELECT a.* , fileSelect(no) fileyn
FROM  (SELECT ROWNUM as rnum,
			  			NO,
						TITLE,
						CONTENT,
						ENROLLDATE,
						VISIBLE,
						ADNO
	   FROM PORTALNOTICE
			WHERE 
			<if test="state == 1">1 = 1 </if>
			<if test="state == 2">title like '%'||#{key}||'%' </if>
			<if test="state == 3">content like '%'||#{key}||'%'</if>
			   ORDER BY enrolldate DESC) a
WHERE rnum
	  between  (#{pageNum}-1)*#{size}
	  AND 		#{pageNum}*#{size}


</select>

<!-- 단건조회 -->
<select id="noticeSelect" 
	parameterType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeVO"
	resultType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeVO">
SELECT * FROM PORTALNOTICE
WHERE no = #{no}
</select>

<!-- 등록 -->
<insert id="noticeInsert"
		parameterType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeVO">

<selectKey resultType="String" keyProperty="no" order="BEFORE">
			SELECT CASE WHEN MAX(NO)!= 0 THEN MAX(NO) + 1 
						ELSE 1 END AS ID FROM PORTALNOTICE
</selectKey>
INSERT INTO PORTALNOTICE
VALUES (#{no}, #{content}, #{title}, #{visible}, 100482, sysDate)
</insert>

<!-- 삭제 -->
<delete id="noticeDelete" parameterType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeVO">
DELETE FROM PORTALNOTICE WHERE NO = #{no}
</delete>

<!-- 수정 -->
<update id="noticeUpdate"
parameterType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeVO">
UPDATE PORTALNOTICE
SET TITLE = #{title},
    CONTENT = #{content},
    ENROLLDATE = sysDate,
    VISIBLE = #{visible}
WHERE NO = #{no}
</update>



<!-- 파일 -->
<!-- 전체조회 -->
<select id ="fileList" 
resultType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeFileVO">
SELECT *
FROM PORTALFILE
</select>

<!-- 단건조회 -->
<select id="fileSelect"
resultType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeFileVO">
SELECT *
FROM PORTALFILE
WHERE PNNO = #{pnno}
</select>

<!-- 등록 -->
<insert id="fileInsert"
		parameterType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeFileVO">
<selectKey resultType="String" keyProperty="no" order="BEFORE">
			SELECT CASE WHEN MAX(NO)!= 0 THEN MAX(NO) + 1 
						ELSE 1 END AS ID FROM PORTALFILE
</selectKey>
INSERT INTO PORTALFILE
VALUES (#{no}, #{name}, #{uri}, #{pnno})	
</insert>


<!-- 삭제 -->
<delete id="fileDelete">
DELETE FROM PORTALFILE
 WHERE NO = #{no}
</delete>

<!-- 게시물과 함께 삭제 -->
<delete id="fileAllDelete" parameterType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeFileVO">
DELETE FROM PORTALFILE
WHERE PNNO = #{no}
</delete>

</mapper>
