<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="co.fourth.tuna.domain.portalNotice.mapper.PortalNoticeMapper">
	
	
<!-- 공지 -->
<!-- 전체조회 -->
<select id="noticeList" parameterType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeVO"
	resultType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeVO">
SELECT * FROM PORTALNOTICE
WHERE
<if test="state == 1">1 = 1 </if>
<if test="state == 2">title like '%'||#{key}||'%' </if>
<if test="state == 3">content like '%'||#{key}||'%'</if>
ORDER BY NO DESC
</select>

<!-- 단건조회 -->
<select id="noticeSelect" 
	parameterType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeVO"
	resultType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeVO">
SELECT * FROM PORTALNOTICE
WHERE no = #{no}
</select>

<!-- 등록 -->
<insert id="noticeInsert"
		parameterType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeVO">

<selectKey resultType="String" keyProperty="no" order="BEFORE">
			SELECT CASE WHEN MAX(NO)!= 0 THEN MAX(NO) + 1 
						ELSE 1 END AS ID FROM PORTALNOTICE
</selectKey>
INSERT INTO PORTALNOTICE
VALUES (#{no}, #{content}, #{title}, #{visible}, 100482, sysDate)
</insert>

<!-- 삭제 -->
<delete id="noticeDelete" parameterType="int">
DELETE FROM PORTALNOTICE WHERE NO = #{no}
</delete>

<!-- 수정 -->
<update id="noticeUpdate"
parameterType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeVO">
UPDATE PORTALNOTICE
<set>
title = #{name}
content = ${content}
enrollDate = sysDate
visible = ${visible}
</set>
where no = ${no}
</update>



<!-- 파일 -->
<!-- 전체조회 -->
<select id ="fileList" 
parameterType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeFileVO"
resultType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeFileVO">
SELECT *
FROM PORTALFILE
</select>

<!-- 단건조회 -->
<select id="fileSelect"
resultType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeFileVO">
SELECT *
FROM PORTALFILE
WHERE pnNo = #{pnNo}
</select>

<!-- 등록 -->
<insert id="fileInsert"
		parameterType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeFileVO">
<selectKey resultType="String" keyProperty="no" order="BEFORE">
			SELECT CASE WHEN MAX(NO)!= 0 THEN MAX(NO) + 1 
						ELSE 1 END AS ID FROM PORTALFILE
</selectKey>
INSERT INTO PORTALFILE
VALUES (#{no}, #{name}, #{uri}, #{pnno})	
</insert>

<!-- 수정 -->
<update id="fileUpdate"
parameterType="co.fourth.tuna.domain.portalNotice.vo.PortalNoticeVO">
UPDATE PORTALNOTICE
<set>
name = #{name}
URI = #{uri}
</set>
where pnNo = ${no}
</update>


<!-- 삭제 -->
<delete id="fileDelete" parameterType="int">
DELETE FROM PORTALFILE WHERE NO = #{pnno}
</delete>

</mapper>
