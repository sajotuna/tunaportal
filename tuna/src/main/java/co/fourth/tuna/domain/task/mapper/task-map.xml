<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.fourth.tuna.domain.task.mapper.TaskMapper">

<!-- <select id="taskList" resultType="map" parameterType="co.fourth.tuna.domain.task.vo.TaskVO">
SELECT T.TITLE, L.SBJNO, T.LIMITDATE
FROM LECTUREAPPLY L JOIN TASK T
ON(L.SBJNO = T.SBJNO)
JOIN SUBJECT J
ON(J.NO = T.SBJNO)
WHERE L.STNO = #{stNo}
AND L.SEASONCODE = #{seasonCode}
AND T.SBJNO = #{sbjNo}
</select> -->

<select id="taskList" resultType="co.fourth.tuna.domain.task.vo.TaskVO">
SELECT * FROM TASK WHERE SBJNO = #{sbjNo}
</select>

<select id="taskSelect" resultType="map" parameterType="co.fourth.tuna.domain.task.vo.TaskVO">
SELECT NO, 
TITLE, 
CONTENT,
TO_CHAR(LIMITDATE, 'YYYY"년"MM"월"DD"일 23:59:59"') LIMITDATE,
TO_CHAR(STARTDATE, 'YYYY"년"MM"월"DD"일 00:00:00"') STARTDATE
FROM TASK WHERE SBJNO = #{sbjNo}
 AND NO = #{no}
</select>

<insert id="taskSubmission" parameterType="co.fourth.tuna.domain.task.vo.SubmitTaskVO">

<selectKey resultType="int" keyProperty="no" order="BEFORE">
SELECT CASE WHEN MAX(NO) != 0 THEN MAX(NO) + 1 ELSE 1 END FROM SUBMITTASK
</selectKey>
INSERT INTO SUBMITTASK
VALUES(#{no}, #{fileName}, SYSDATE, 0, #{stNo}, #{taskNo}, #{uri})
</insert>

<select id="findSubmission" resultType="co.fourth.tuna.domain.task.vo.SubmitTaskVO" parameterType="co.fourth.tuna.domain.task.vo.SubmitTaskVO">
SELECT * FROM SUBMITTASK 
WHERE STNO = #{stNo}
AND TASKNO = #{taskNo}
</select>

</mapper>