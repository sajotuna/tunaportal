<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    data-layout-decorate="~{layouts/navLayout}">
<head>
	<meta charset="UTF-8">
	<title>currentSemesterGrade</title>
	<style>
	.scroll-table-div {
		width: 100%;
		height:300px; 
		overflow:scroll;
	}
	.scroll-table {
		width:1203px;
	}
	</style>
</head>
<body>
<main layout:fragment="main">
	<!-- Hero -->
	<div class="bg-body-light">
		<div class="content content-full content-boxed">
			<div
				class="d-flex flex-column flex-md-row justify-content-md-between align-items-md-center py-2 text-center text-md-start">
				<div class="flex-grow-1 mb-1 mb-md-0">
					<p class="h3 fw-bold mb-2">당해학기 성적 조회</p>
					<p class="h6 fw-medium fw-medium text-muted mb-0 text-gray-dark">
						당해학기 성적 조회 및 성적 이의신청</p>
				</div>
			</div>
		</div>
	</div>
	<!-- END Hero -->
	<!-- Page Content -->
	<div class="mt-3">
		<div class="content content-full content-boxed">
			<!-- Block -->
			<div class="block block-rounded block-themed mb-4">
				<div class="block-header bg-primary-darker">
					<h3 class="block-title">수강 과목 및 성적</h3>
					<div class="block-options">
						<button type="button" class="btn btn-sm btn-light"
							data-bs-toggle="modal" data-bs-target="#objection">성적 이의신청</button>
					</div>
				</div>
						<!-- Table -->
						<div class="scroll-table-div">
						<table class="table table-striped table-vcenter scroll-table">
							<thead>
								<tr>
									<th style="width: 150px;">연도학기</th>
									<th style="width: 100px;">이수구분</th>
									<th style="width: 150px;">교과목-분반</th>
									<th>과목명</th>
									<th style="width: 100px;">학점</th>
									<th style="width: 100px;">등급</th>
									<th style="width: 100px;">평점</th>
									<th style="width: 100px;">강의평가</th>
								</tr>
							</thead>
							<tbody class="tb">
								
							</tbody>
						</table>
						</div>
						<!-- END Table -->
			</div>
			<!-- END Block -->
			<!-- Block -->
			<div class="block block-rounded block-themed mb-4">
				<div class="block-header bg-primary-darker">
					<h3 class="block-title">성적 누계</h3>
				</div>
					<!-- Table -->
					<table class="table table-vcenter table-striped">
						<thead>
							<tr>
								<th class="text-center">신청과목수</th>
								<th class="text-center">신청학점</th>
								<th class="text-center">평점평균</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td scope="row" class="text-center fw-semibold fs-sm" id="count">0</td>
								<td class="text-center fw-semibold fs-sm" id="total">0</td>
								<td class="text-center fw-semibold fs-sm" id="avg">0</td>
							</tr>
						</tbody>
					</table>
					<!-- END Table -->
			</div>
			<!-- END Block -->
		</div>
	</div>
	<!-- END Page Content -->
	
	<!-- Objection Modal -->
	<div class="modal" id="objection" tabindex="-1" role="dialog" aria-labelledby="modal-block-vcenter" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-xl"role="document">
			<div class="modal-content">
				
				<div class="block block-rounded block-transparent mb-0">
					<div class="block-header block-header-default">
						<h3 class="block-title">성적 이의신청 및 답변 조회</h3>
						<div class="block-options">
							<button type="button" class="btn-block-option"
								data-bs-dismiss="modal" aria-label="Close">
								<i class="fa fa-fw fa-times"></i>
							</button>
						</div>
					</div>
					<div class="block-content block-content-full">
						<!-- Block -->
						<div class="block block-rounded block-themed mb-4">
							<div class="block-header bg-primary-darker">
								<h4 class="block-title">강의 목록</h4>
							</div>
							<div class="scroll-table-div">
								<table class="table table-hover table-vcenter" style="width:1083px;">
									<thead>
										<tr>
											<th style="width: 150px;">연도학기</th>
											<th style="width: 100px;">이수구분</th>
											<th style="width: 150px;">교과목-분반</th>
											<th>과목명</th>
											<th style="width: 100px;">학점</th>
											<th style="width: 100px;">등급</th>
											<th style="width: 100px;">평점</th>
											<th style="width: 100px;">강의평가</th>
										</tr>
									</thead>
									<tbody id="objectionTb" class="tb">
									
									</tbody>
								</table>
							</div>
						</div>
						<!-- END Block -->
						<!-- Objection Insert Form -->
						<div class="block block-rounded block-themed mb-4">
							<div class="block-header bg-primary-darker">
								<h4 class="block-title">이의신청 및 답변 조회</h4>
							</div>
							<form class="mb-4" action="">
								<table class="table table-vcenter">
									<tr>
										<th scope="row" class="d-none d-xl-table-cell table-active" style="width: 150px;">과목명</th>
										<td class="fw-semibold fs-sm" style="width: 250px;"></td>
										<th class="d-none d-xl-table-cell table-active" style="width: 150px;">담당교수</th>
										<td class="fw-semibold fs-sm"></td>
										<th class="d-none d-xl-table-cell table-active" style="width: 150px;">진행상태</th>
										<td class="fw-semibold fs-sm"></td>
									</tr>
									<tr>
										<th scope="row" class="d-none d-xl-table-cell table-active" style="width: 150px;">이의신청 내용</th>
										<td class="fw-semibold fs-sm" colspan="5">
											<textarea rows="4" placeholder="내용을 입력하세요." style="width: 100%"></textarea>
										</td>
									</tr>
									<tr>
										<th scope="row" class="d-none d-xl-table-cell table-active"style="width: 150px;">답변</th>
										<td class="fw-semibold fs-sm" colspan="5"></td>
									</tr>
								</table>
							</form>
						</div>
						<!-- END Objection Insert Form -->
					</div>
					
					<div class="block-content block-content-full text-end bg-body">
						<button type="button" class="btn btn-sm btn-alt-secondary me-1"
							data-bs-dismiss="modal">닫기</button>
						<button type="button" class="btn btn-sm btn-primary"
							data-bs-dismiss="modal">등록</button>
					</div>
				</div>
				
			</div>
		</div>
	</div>
	<!-- END Objection Modal -->
	<script type="text/javascript">
	
		$(function() {
			currentSemesterGradeAjax();
			objectionInsertView();
		})
		
		function currentSemesterGradeAjax() {
			
			$.ajax({
				
				url: getContextPath() + 'stud/currentSemesterGradeList',
				type: 'GET',
				data: {stNo:20142268, seasonCode:'106'},
				dataType: 'json',

			}).done(function(grades) {

				let count = 0;
				let total = 0;
				let sum = 0;
				
				for(grade of grades) {
					
					count++;
					total += parseInt(`${grade.POINT}`);
					sum += parseFloat(`${grade.TOTAL}`);
					
					let evalState = '';
					let alphabet = '';
					let totalGrade = '';
					if (grade.EVALSTATE === 'y') {
						evalState = 'O';
						alphabet = grade.ALPHABET;
						totalGrade = grade.TOTAL;
					} else {
						evalState = 'X';
						alphabet = '비공개';
						totalGrade = '비공개';
					}
				
					$('.tb').append($('<tr>').append($('<td>').addClass('fw-semibold fs-sm').text(grade.SEASONCODE))
										     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.TYPE))
										     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.NO))
										     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.NAME))
										     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.POINT))
										     .append($('<td>').addClass('fw-semibold fs-sm').text(alphabet))
										     .append($('<td>').addClass('fw-semibold fs-sm').text(totalGrade))
										     .append($('<td>').addClass('fw-semibold fs-sm').text(evalState))
									);
				}
				
				let avg = sum/count;
				
				$('#count').text(count);
				$('#total').text(total);
				$('#avg').text(avg.toFixed(2));
			})	
		}
		
		function objectionInsertView() {
			$(document).on('click', '#objectionTb tr', function() {
				$('#objectionTb tr').removeClass('table-primary');
				$(this).addClass('table-primary');
				
				// 이의신청 및 조회 ajax
				
			})
		}
		
		function getContextPath() {
			var pathName = window.location.pathname.substring(1);
			var webName = pathName == '' ? '' : pathName.substring(0, pathName.indexOf('/'));
			var path_root = window.location.protocol + '//' + window.location.host + '/' + webName + '/';
			return path_root;
		}
	
	</script>
</main>
</body>
</html>