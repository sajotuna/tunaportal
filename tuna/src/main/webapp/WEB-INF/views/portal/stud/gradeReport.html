<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
<th:block th:fragment="grade">
	<div class="tab-pane" id="btabs-static-grade" role="tabpanel"
		aria-labelledby="btabs-static-grade-tab">
		<!-- Bar Chart -->
		<div class="block block-rounded block-themed mb-4">
			<div class="flex-grow-1 d-flex align-items-center justify-content-center chart-margin">
				<div class="col-9">
					<canvas id="js-chartjs-earnings"></canvas>
				</div>
			</div>
		</div>
		<!-- END Bar Chart -->
		<!-- Ring Chart -->
		<div class="block block-rounded block-themed mb-4">
			<div class="row justify-content-center chart-margin">
				<div class="col-3">
					<div class="js-pie-chart pie-chart" data-percent="85"
						data-line-width="20" data-size="180" data-bar-color="#abe37d"
						data-track-color="#eeeeee">
						<!-- <div class="text-center mb-4">총 취득 학점</div> -->
						<span>
							<span class="h2">112</span><br> <small class="text-muted">/137</small>
						</span>
					</div>
				</div>
				<div class="col-3">
					<div class="js-pie-chart pie-chart" data-percent="87"
						data-line-width="20" data-size="180" data-bar-color="#fadb7d"
						data-track-color="#eeeeee">
						<!-- <div class="text-center mb-4">총 평점 평균</div> -->
						<span>
							<span class="h2">3.76</span><br> <small class="text-muted">/4.5</small>
						</span>
					</div>
				</div>
				<div class="col-3">
					<div class="js-pie-chart pie-chart" data-percent="91.54"
						data-line-width="20" data-size="180" data-bar-color="#faad7d"
						data-track-color="#eeeeee">
						<!-- <div class="text-center mb-4">백분율 성적</div> -->
						<span>
							<span class="h2">91.54</span><br> <small class="text-muted">/100</small>
						</span>
					</div>
				</div>
			</div>
		</div>
		<!-- END Ring Chart -->
		<!-- Lecture grade list -->
		<div class="block block-rounded block-themed mb-4">
			<div class="block-header bg-primary-darker">
				<h4 class="block-title">과목별 성적 내역</h4>
				<div class="block-options">
					<select class="form-select btn-sm" id="subjectGradeSelect" name="seasonCode" style="width: 150px;">
						<option selected value="all">전체 학기</option>
						<option value="106">2022년도 2학기</option>
						<option value="105">2022년도 1학기</option>
					</select>
				</div>
				<div class="block-options">
					<button type="button" id="pdfBtn" class="btn btn-sm btn-light" data-bs-toggle="modal" data-bs-target="#pdf">PDF</button>
				</div>
			</div>
			<!-- Table -->
			<div class="mb-4 scroll-table-div">
				<table id="my-table" class="table table-striped table-vcenter scroll-table">
					<thead>
						<tr>
							<th style="width: 150px;">연도/학기</th>
							<th style="width: 150px;">이수구분</th>
							<th style="width: 150px;">교과목-분반</th>
							<th>과목명</th>
							<th style="width: 150px;">학점</th>
							<th style="width: 150px;">등급</th>
							<th style="width: 150px;">평점</th>
						</tr>
					</thead>
					<tbody id="subjectGradeTb">
						
					</tbody>
				</table>
			</div>
			<!-- END Table -->
		</div>
		<!-- END Lecture grade list -->
		
		<div class="row">
			<!-- Grade avg -->
			<div class="col-7">
				<div class="block block-rounded block-themed mb-4">
					<div class="block-header bg-primary-darker">
						<h4 class="block-title">평균 평점</h4>
					</div>
					<!-- Table -->
					<div class="mb-4" style="height:200px; overflow:auto;">
						<table class="table table-striped table-vcenter text-center">
							<thead>
								<tr>
									<th class="d-none d-sm-table-cell">연도/학기</th>
									<th class="d-none d-sm-table-cell">취득학점</th>
									<th class="d-none d-sm-table-cell">평점평균</th>
								</tr>
							</thead>
							<tbody id="avgGradeTb">
								
							</tbody>
						</table>
					</div>
					<!-- END Table -->
				</div>
			</div>
			<!-- END Grade avg -->
			<!-- Total grade -->
			<div class="col-5">
				<div class="block block-rounded block-themed mb-4">
					<div class="block-header bg-primary-darker">
						<h4 class="block-title">이수구분별 취득 학점</h4>
					</div>
					<!-- Table -->
					<div class="mb-4">
						<table id="typeGrade" class="table table-striped table-vcenter text-center ">
							<tr>
								<th scope="row" class="d-none d-sm-table-cell" style="width: 50%;">전공필수</th>
								<td class="fw-semibold fs-sm">0</td>
							</tr>
							<tr>
								<th scope="row" class="d-none d-sm-table-cell" style="width: 50%;">전공기초</th>
								<td class="fw-semibold fs-sm">0</td>
							</tr>
							<tr>
								<th scope="row" class="d-none d-sm-table-cell" style="width: 50%;">필수교양</th>
								<td class="fw-semibold fs-sm">0</td>
							</tr>
							<tr>
								<th scope="row" class="d-none d-sm-table-cell" style="width: 50%;">일반교양</th>
								<td class="fw-semibold fs-sm">0</td>
							</tr>
						</table>
					</div>
					<!-- END Table -->
				</div>
			</div>
			<!-- END total grade -->
		</div>
	</div>
	
	<!-- PDF Modal -->
	<div class="modal" id="pdf" tabindex="-1" role="dialog" aria-labelledby="modal-block-vcenter" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-xl"role="document">
			<div class="modal-content">
				<div class="block block-rounded block-transparent mb-0">
					<div class="block-header block-header-default">
							<h3 class="block-title">과목별 성적 내역</h3>
							<div class="block-options">
								<button type="button" class="btn-block-option"
									data-bs-dismiss="modal" aria-label="Close">
									<i class="fa fa-fw fa-times"></i>
								</button>
							</div>
					</div>
					<div class="block-content block-content-full">
						<iframe id="pdfFrame" type="application/pdf" style="width:100%; height:500px; background:gray;"></iframe>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- END PDF Modal -->

	<!-- Script -->
	<script th:src="@{/resources/assets/js/plugins/chart.js/chart.min.js}"></script>
	<script th:src="@{/resources/assets/js/plugins/easy-pie-chart/jquery.easypiechart.min.js}"></script>
	<script th:src="@{/resources/assets/js/plugins/jquery-sparkline/jquery.sparkline.min.js}"></script>
	<script th:src="@{/resources/assets/js/pages/be_comp_charts.min.js}"></script>
	<script th:src="@{/resources/assets/js/pages/be_pages_dashboard.min.js}"></script>
	<script>One.helpersOnLoad([ 'jq-easy-pie-chart', 'jq-sparkline' ]);</script>
	
	<script th:src="@{/resources/assets/js/autoTableToPdf.js}"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.2.11/jspdf.plugin.autotable.min.js" integrity="sha512-5DeDgl/s7g7z1Z3XAey28NhA289vT9aGbLoPGFGFhwnkkZ8WRbepIM8fKB3OCYWgezPyzzQYHED8TyPd9qSKTA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<!-- END Script -->
	
	<script type="text/javascript">
		let table = document.querySelector('#my-table');
		pdfBtn.addEventListener('click', function() {
			pdfFrame.setAttribute('src', tableToPdf(table));
		});
		
		$(function() {
			subjectGrade();
			avgGrade();
			seasonSubjectGrade();
		})
		
		function subjectGrade() {

			$.ajax({
				
				url: getContextPath() + 'stud/subjectGrade',
				type: 'GET',
				data: {stNo:20142268},
				dataType: 'json',

			}).done(function(grades) {
				
				let type1 = 0, type2 = 0, type3 = 0, type4 = 0;
				
				$('#subjectGradeTb').html('');
				for (grade of grades) {
					
					switch(grade.TYPE) {
						case '701' : type1 += parseInt(`${grade.POINT}`); break;
						case '702' : type2 += parseInt(`${grade.POINT}`); break;
						case '703' : type3 += parseInt(`${grade.POINT}`); break;
						case '704' : type4 += parseInt(`${grade.POINT}`); break;
					}
					
					$('#subjectGradeTb').append($('<tr>').append($('<td>').addClass('fw-semibold fs-sm').text(grade.SEASONCODE))
													     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.TYPE))
													     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.NO))
													     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.NAME))
													     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.POINT))
													     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.ALPHABET))
													     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.TOTAL))
												);	
					
					
				}
				
				let types = [type1, type2, type3, type4];
				
				for (i=0; i<types.length; i++) {
					$('#typeGrade td').eq(i).text(types[i])
				}
			})
			
		}
		
		function seasonSubjectGrade() {
			$('select[id=subjectGradeSelect]').on('change', function() {
				
				if($(this).val() === 'all') {
					
					subjectGrade();
					
				} else {
					
					$.ajax({
						
						url: getContextPath() + 'stud/seasonSubjectGrade',
						type: 'GET',
						data: {stNo:20142268, seasonCode:$(this).val()},
						dataType: 'json',

					}).done(function(grades) {
						$('#subjectGradeTb').html('');
						for (grade of grades) {
							$('#subjectGradeTb').append($('<tr>').append($('<td>').addClass('fw-semibold fs-sm').text(grade.SEASONCODE))
															     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.TYPE))
															     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.NO))
															     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.NAME))
															     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.POINT))
															     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.ALPHABET))
															     .append($('<td>').addClass('fw-semibold fs-sm').text(grade.TOTAL))
														);		
						}
					})
				}
			})
		}
		
		function avgGrade() {
			
			$.ajax({
				
				url: getContextPath() + 'stud/avgGrade',
				type: 'GET',
				data: {stNo:20142268},
				dataType: 'json',

			}).done(function(grades) {
				
				for (grade of grades) {
					$('#avgGradeTb').append($('<tr>').append($('<td>').addClass('fw-semibold fs-sm').text(grade.SEASONCODE))
													 .append($('<td>').addClass('fw-semibold fs-sm').text(grade.SUM))
													 .append($('<td>').addClass('fw-semibold fs-sm').text(grade.AVG))
										   );		
				}
			})
			
		}
		
	</script>
</th:block>
</body>
</html>