<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>subjectSelect</title>
</head>
<body>
<th:block th:fragment="lecturePlan">
	<div class="tab-pane active" id="btabs-static-subject"
		role="tabpanel" aria-labelledby="btabs-static-subject-tab">
		<!-- Form -->
		<form class="row" id="searchFrm">
			<div class="col-xl-4">
				<div class="mb-3 mb-xl-2 ">
					<select class="form-select" id="season" name="seasonCode">
						<option selected>연도/학기</option>
						<option value="106">2022년도 2학기</option>
						<option value="105">2022년도 1학기</option>
					</select>
				</div>
			</div>
			<div class="col-md-6 col-xl-4">
				<div class="block block-rounded bg-primary-darker mb-2">
					<div class="space-x-2 text-center text-gray-light">
						<div class="form-check form-check-inline">검색 대상</div>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio"
								id="lecture" name="searchKey"
								value="lecture" checked> 
							<label class="form-check-label" for="lecture">과목명</label>
						</div>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio"
								id="prof" name="searchKey"
								value="professor"> 
							<label class="form-check-label" for="prof">교수명</label>
						</div>
					</div>
				</div>
			</div>
			<div class="col-md-6 col-xl-3">
				<div class="mb-3">
					<input type="text" class="form-control" id="key" name="key" placeholder="검색어">
				</div>
			</div>
			<div class="col-md-12 col-xl-1">
				<div class="mb-3">
					<button type="button" id="search" class="btn btn-primary w-100">조회</button>
				</div>
			</div>
		</form>
		<!-- END Form -->
		<!-- Table -->
		<div class="mb-4 scroll-table-div">
			<table class="table table-striped table-vcenter scroll-table">
				<thead>
					<tr>
						<th style="width: 120px;">과목코드</th>
						<th style="width: 70px;">분반</th>
						<th style="width: 100px;">개설학과</th>
						<th style="width: 120px;">이수구분</th>
						<th style="width: 230px;">과목명</th>
						<th style="width: 100px;">교수명</th>
						<th style="width: 70px;">학년</th>
						<th style="width: 70px;">학점</th>
					</tr>
				</thead>
				<tbody id="lecturePlanTb">
					
				</tbody>
			</table>
		</div>
		<!-- END Table -->
	</div>
			
	<!-- lecture Plan Modal -->
	<div class="modal" id="lecturePlan" tabindex="-1" role="dialog" aria-labelledby="modal-block-vcenter" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-xl"role="document">
			<div class="modal-content">
				<div class="block block-rounded block-transparent mb-0">
					<div class="block-header block-header-default">
							<h3 class="block-title">강의 계획서</h3>
							<div class="block-options">
								<button type="button" class="btn-block-option"
									data-bs-dismiss="modal" aria-label="Close">
									<i class="fa fa-fw fa-times"></i>
								</button>
							</div>
					</div>
					<div class="block-content block-content-full">
						
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- END lecture Plan Modal -->
	
	<!-- lecture Evaluation Modal -->
	<div class="modal" id="lectureEval" tabindex="-1" role="dialog" aria-labelledby="modal-block-vcenter" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered modal-xl"role="document">
			<div class="modal-content">
				<div class="block block-rounded block-transparent mb-0">
					<div class="block-header block-header-default">
							<h3 class="block-title">강의평가</h3>
							<div class="block-options">
								<button type="button" class="btn-block-option"
									data-bs-dismiss="modal" aria-label="Close">
									<i class="fa fa-fw fa-times"></i>
								</button>
							</div>
					</div>
					<div class="block-content block-content-full">
						
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- END lecture Evaluation Modal -->
	<script th:inline="javascript">
	 /*<![CDTATA[*/
	var header = $("meta[name='_csrf_header']").attr('content');
	var token = $("meta[name='_csrf']").attr('content');
	
	$(function() {
		searchSubjectsAjax();
	})
	
	function searchSubjectsAjax() {
	
		$('#search').on('click', function() {
			
			let seasonCode = $('select[name=seasonCode]').val();
			let key = $('input[name=key]').val();
			let searchKey = $('input:radio:checked').val();
			
			$.ajax({
				
				url: getContextPath() + 'stud/searchSubjectList',
				type: 'GET',
				data: {seasonCode:seasonCode,key:key,searchKey:searchKey},
				dataType: 'json',
				beforeSend: function (xhr) {
					xhr.setRequestHeader(header, token);
				}
	
			}).done(function(subjects) {
				
				$('#lecturePlanTb').html('');
				
				for (subject of subjects) {
	
					$('#lecturePlanTb').append($('<tr>')
												.append($('<td>').addClass('fw-semibold fs-sm').append($('<a>').attr('href', '#')
																		   		 				.attr('data-bs-toggle', 'modal')
																		   		 				.attr('data-bs-target', '#lecturePlan')
																		   		 				.text(`${subject.no}`)))
												.append($('<td>').addClass('fw-semibold fs-sm').text(`${subject.group}`))
												.append($('<td>').addClass('fw-semibold fs-sm').text(/*[[${@codeList.getName(*/`${subject.deptCode}`/*)}]]*/))
												.append($('<td>').addClass('fw-semibold fs-sm').text(`${subject.type}`))
												.append($('<td>').addClass('fw-semibold fs-sm').text(`${subject.name}`))
												.append($('<td>').addClass('fw-semibold fs-sm')
																 .append($('<a>').attr('href', '#')
																		   		 .attr('data-bs-toggle', 'modal')
																		   		 .attr('data-bs-target', '#lectureEval')
																		   		 .text(`${subject.pfName}`)))
												.append($('<td>').addClass('fw-semibold fs-sm').text(`${subject.target}`))
												.append($('<td>').addClass('fw-semibold fs-sm').text(`${subject.point}`))
												);
					
				}
			})
		})
		
	}
	
	function getContextPath() {
		var pathName = window.location.pathname.substring(1);
		var webName = pathName == '' ? '' : pathName.substring(0, pathName.indexOf('/'));
		var path_root = window.location.protocol + '//' + window.location.host + '/' + webName + '/';
		return path_root;
	}
	/*]]*/
	</script>
</th:block>
</body>
</html>