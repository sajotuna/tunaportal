<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	data-layout-decorate="~{layouts/navLayout}">
<head>
<meta charset="UTF-8">
<title>portalNoticeList</title>

</head>
<body>
	<main layout:fragment="main">
		<!--title start-->
		<div class="content content-boxed">
			<h3 class="fw-bold">학사공지 목록</h3>
			<!--title end-->
			<div class="block block-rounded">
				<div class="block-content">
					<div class="row">
						<!-- Search Form (visible on larger screens) -->
						<form id="frm" class="row d-flex justify-content-end" action=""
							method="post">
							<input type="hidden" th:name="_csrf" th:value="${_csrf.token}" />
							<div class="col-2">
								<select name="state" id="state" class="form-select">
									<option value="1">전체보기</option>
									<option value="2">제목</option>
									<option value="3">내용</option>
								</select>
							</div>
							<div class="col-3 p-0">
								<div class="input-group">
									<input type="text" class="form-control form-control-alt"
										id="key" name="key" placeholder="Search">
									<button id = "searchBtn" type="button" onclick="searchList()"
										class="btn btn-alt-secondary">
										<i class="fa fa-search"></i>
									</button>
								</div>
							</div>
						</form>
					</div>
					<!-- END Search Form -->


					<!-- If you put a checkbox in thead section, it will automatically toggle all tbody section checkboxes -->
					<table id="tb"
						class="js-table-checkable table table-hover table-vcenter">
						<!--thead 표 제목-->
						<thead>
							<tr>
								<th class="text-center" style="width: 10%;">#</th>
								<th style="text-align: center">제목</th>
								<th style="text-align: center; width: 10%; height: 10%;">첨부파일</th>
								<th class="d-none d-sm-table-cell"
									style="text-align: center; width: 20%;">Date</th>
							</tr>

						</thead>
						<!--tbody 표 내용-->
						<tbody>

							<th:block class="text-center" scope="row"
								th:if="${not #strings.isEmpty(notices)}">

								<tr th:each="notices, i:${notices}" th:data-no=${notices.no}>
									<td class="text-center" id="nocheck">[[${notices.no}]]</td>
									<td><a
										th:href="@{/portalNoticeSelect(no=${notices.no})}">[[${notices.title}]]</a></td>
									<td class="">
										
											<th:block th:if="${notices.fileyn == 'Y'}">
												<p style="text-align: center; margin: 0 0 0 0">
													<i class="far fa fa-file"></i>
												</p>
											</th:block>
										
									</td>
									<td class="fs-sm text-muted text-center">[[${notices.enrollDate}]]</td>
								</tr>

							</th:block>
						</tbody>

					</table>

					<div class="block-content d-flex justify-content-center ">
						<nav aria-label="Page navigation">
							<ul class="pagination pagination-sm">
							 <li class="page-item">
							  <a class="page-link" href="javascript:void(0)" tabindex="-1" id="prev" aria-label="Previous">
								 <span aria-hidden="true"> 
									<i class="fa fa-angle-left"></i>
								</span>
								<span class="visually-hidden">Previous</span>
							  </a>
							 </li>
							 <li class="page-item">
							 <a class="page-link" id="pageBtn" href="javascript:void(0)">1</a></li>
								<li class="page-item"><a class="page-link" id="pageBtn" href="javascript:void(0)">2</a></li>
								<li class="page-item"><a class="page-link" id="pageBtn" href="javascript:void(0)">3</a></li>
								<li class="page-item"><a class="page-link" href="javascript:void(0)" aria-label="Next" id="next">
								 <span aria-hidden="true">
								  <i class="fa fa-angle-right"></i>
								 </span>
								 <span class="visually-hidden">Next</span>
								</a></li>
							</ul>
						</nav>
					</div>


				</div>
			</div>

		</div>
		<script>
		var header = $("meta[name='_csrf_header']").attr('content');
		var token = $("meta[name='_csrf']").attr('content');
		
		

		//검색기능
		function searchList() {
			let state= $("#state").val();
			let key = $("#key").val();			
			$.ajax({
				url : getPathRootJump() + "admin/adminSearch",
				type: "get",
				data : {state:state,key:key},
				dataType : "json",
				success : function(rs){
					htmlConvert(rs);
				},
				error : function(){
					alert('오류')
				}
			})	
		}

		
		function htmlConvert(rs){
			$("tbody").remove();
			let tbody = $("<tbody/>");
			$.each(rs,function(index, n){ 
				var td = $("<td/>").addClass("text-center filecheck")
				if(n.fileyn == "Y"){
					td.html(`<p style="text-align: center; margin: 0 0 0 0"> <i class="far fa fa-file"></i></p>`)
				}
				var row = $("<tr/>").append(
						  $("<td/>").addClass("text-center").css("width","10px").html(n.no),
						  $("<td/>").html(`<a href="portalNoticeSelect?no=${n.no}"> ${n.title} </a>`),
						  td,
						  $("<td/>").addClass("fs-sm text-muted text-center").html(n.enrollDate)
					);
				tbody.append(row); 

				
			})//forEach end
			$("#tb").append(tbody);
		}

			
			//페이지이동
			 document.addEventListener('DOMContentLoaded', function(){
					
					
					let nextBtn = document.querySelector("#next")
					let prevBtn = document.querySelector("#prev")
					let pageBtn = document.querySelectorAll("#pageBtn");
					
 					nextBtn.addEventListener('click', function(){
 						pageBtn.forEach(btn =>{
 							let a = btn.innerHTML
 							btn.innerHTML = parseInt(a)+3;
 						})
 					})
					
 					prevBtn.addEventListener('click', function(){
 						pageBtn.forEach(btn =>{
 							let a = btn.innerHTML
 							if (parseInt(a) > 3){
 								btn.innerHTML = parseInt(a)-3;
 							}
							
 						})
 					})
					
					pageBtn.forEach(btn =>{
						btn.addEventListener('click',function(){
							let a = btn.innerHTML
							location.href = '/tuna/portalNoticeList?pageNum='+parseInt(a)
						})
					})
										
				})
		


		function getPathRootJump() {
		    var pathName = window.location.pathname.substring(1);
		    var webName = pathName == '' ? '' : pathName.substring(0, pathName.indexOf('/'));
		    var path_root = window.location.protocol + '//' + window.location.host + '/' + webName + '/';
		    return path_root;
		 }


</script>
	</main>
</body>
</html>