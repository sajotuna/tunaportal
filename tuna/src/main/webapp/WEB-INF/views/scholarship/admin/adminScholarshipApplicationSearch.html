<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
    data-layout-decorate="~{layouts/adminLayout}">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
	
  <title>장학신청조회</title>
  <link rel="stylesheet" th:href="@{/resources/assets/js/plugins/flatpickr/flatpickr.min.css}">
  <style>

    h5 {
      margin-top: 50px;
      margin-left: 20px;
    }

    .fomrtag {
      margin-left: 50px;
      margin-top: 10px;
    }
  </style>

</head>

<body>
<main layout:fragment="main">
  <div id="section">
    <div class="content">
      <div id="page-container">
        <h3 class="h3 fw-bold mb-2">장학신청 조회</h3>
        <div class=" bg-body-extra-light" style="padding: 10px;">
        <form th:action="@{/admin/adminScholarshipApplicationSearch}" method="post" class="row">
          <div class="col-md-4 col-xl-3 fomrtag">
            <div class="mb-2">
              <select class="form-select" id="year" name="year">
                <option selected value="">연도/학기</option>
                <option value="108" id = "108">2023년 2학기</option>
	            <option value="107" id = "107">2023년 1학기</option>
	            <option value="106" id = "106">2022년 2학기</option>
	            <option value="105" id = "105">2022년 1학기</option>
	            <option value="104" id = "104">2021년 1학기</option>
	            <option value="103" id = "103">2021년 2학기</option>
	            <option value="102" id = "102">2020년 1학기</option>
	            <option value="101" id = "101">2020년 2학기</option>
              </select>
            </div>
          </div>
          <div class="col-md-4 col-xl-3 fomrtag">
            <div class="mb-2">
              <select class="form-select" id="schno" name="schno">
                <option selected value="">신청구분</option>
                <option value="1" id = "10">성적우수</option>
                <option value="2" id = "11">가족</option>
                <option value="3" id = "12">교직원가족</option>
              </select>
            </div>
          </div>
          <div class="col-md-4 col-xl-3 fomrtag">
            <div class="mb-2">
              <input type="text" class="js-flatpickr form-control"
                id="applydate" name="applydate" placeholder="신청일자"
                data-mode="range" readonly="readonly">
                <input type="file" multiple="multiple" class="dz-hidden-input" 
                tabindex="-1" 
                style="visibility: hidden; position: absolute; top: 0px; left: 0px; 
                height: 0px; width: 0px;">
            </div>
            
          </div>
          <div class="col-md-4 col-xl-3 fomrtag">
            <div class="mb-2">
              <select class="form-select" id="sy" name="sy">
                <option selected value="">학년</option>
                <option value="1" id ="1">1학년</option>
                <option value="2" id ="2">2학년</option>
                <option value="3"id ="3">3학년</option>
                <option value="4" id ="4">4학년</option>
              </select>
            </div>
          </div>
          <div class="col-md-4 col-xl-3 fomrtag">
            <div class="mb-2">
              <input type="text" placeholder="학번을 입력하세요.." class="form-control" id="no"
                name="no">
            </div>
          </div>
          <div class="col-md-4 col-xl-3 fomrtag">
            <div class="mb-2">
              <select class="form-select" id="schState" name="schState">
                <option selected value="">심사현황</option>
                <option value="501" id="501">심사대기</option>
                <option value="502" id="502">심사중</option>
                <option value="503" id="503">심사거절</option>
                <option value="504" id="504">심사완료</option>
              </select>
            </div>
          </div>
          <div class="col-md-2 col-xl-1 fomrtag">
            <div>
              <button type="submit" class="btn btn-secondary col-sm-12">조회</button>
            </div>
          </div>

        </form>
        <div class="mb-5 mt-5">
              <div class="block block-rounded block-themed">
                <div class="block-header bg-primary-darker">
                  <h1 class="block-title">[장학내역]</h1>
                </div>
          

          <div class="d-flex justify-content-end">
            <div class="m-2">
              <button type="button" class="btn btn-secondary" id = "allSelect">전체선택</button>
            </div>
          </div>
          <form th:action = "@{/admin/scholarCheck}" id = "frm" method="post" >
          <input type="hidden" th:name="_csrf" th:value="${_csrf.token}"/>
          <table class="table table-striped table-vcenter">
          <thead>
              <tr>
                <th class="d-none d-sm-table-cell" style="width: 80px;">선택</th>
                <th class="d-none d-sm-table-cell" style="width: 100px;">학번</th>
                <th class="d-none d-sm-table-cell" style="width: 100px;">성명</th>
                <th class="d-none d-sm-table-cell" style="width: 120px;">재적상태</th>
                <th class="d-none d-sm-table-cell" style="width: 80px;">학년</th>
                <th class="d-none d-sm-table-cell" style="width: 120px;">수강학점</th>
                <th class="d-none d-sm-table-cell" style="width: 80px;">평점</th>
                <th class="d-none d-sm-table-cell" style="width: 100px;">학과</th>
                <th class="d-none d-sm-table-cell" style="width: 120px;">입학일</th>
                <th class="d-none d-sm-table-cell" style="width: 120px;">신청이름</th>
                <th class="d-none d-sm-table-cell" style="width: 110px;">접수번호</th>
                <th class="d-none d-sm-table-cell" style="width: 110px;">심사현황</th>
                <th class="d-none d-sm-table-cell" style="width: 100px;">신청날짜</th>
                <th class="d-none d-sm-table-cell" style="width: 100px;">첨부파일</th>
              </tr>
            </thead>
            <tbody>
              <tr th:scope="row" th:each="sch, status : ${list}">
                      <th class="fw-semibold fs-sm"><input type="checkbox" name = "scholarCheckbox" th:value = "${sch.SCHNO}"><input type = "hidden" th:value = "${sch.SEASONCODE}" name = "seasonCode"></th>
                      <th class="fw-semibold fs-sm" th:text="${sch.NO}"></th>
                      <td class="fw-semibold fs-sm" th:text = "${sch.NAME}"></td>
                      <td class="fw-semibold fs-sm" th:text = "${@codeList.getName(sch.STATECODE)}"></td>
                      <td class="fw-semibold fs-sm" th:text = "${sch.SY}"></td>
                      <td class="fw-semibold fs-sm" th:text = "${sch.PREVGRADE}"></td>
                      <td class="fw-semibold fs-sm" th:text = "${sch.AVGSCORE}"></td>
                      <td class="fw-semibold fs-sm" th:text = "${@codeList.getName(sch.DEPTCODE)}"></td>
                      <td class="fw-semibold fs-sm" th:text = "${#dates.format(sch.ENTERDATE, 'yyyy-MM-dd')}"></td>
                    <td class="fw-semibold fs-sm" th:text = "${sch.SCHNAME}"></td>
                    <td class="fw-semibold fs-sm" th:text = "${sch.SCHNO}"></td>
                    <td class="fw-semibold fs-sm" th:text = "${@codeList.getName(sch.SCHSTATECODE)}"></td>
                    <td class="fw-semibold fs-sm" th:text = "${#dates.format(sch.APPLYDATE, 'yyyy-MM-dd')}"></td>
                    <td class="fw-semibold fs-sm filebox">
	                      	<th:block th:if = "${not #strings.isEmpty(sch.FILENAME)}">
	                      	<a th:href="@{/download(fileName=${sch.URI}, originName=${sch.FILENAME}, folder=Scholar)}">[[${sch.FILENAME}]]</a>
	                      	</th:block>
	                      	<th:block th:unless = "${not #strings.isEmpty(sch.FILENAME)}">
	                      		<label for="file" id = "filetag" >파일 없음</label>
	                      	</th:block>
                      </td>
                    </tr>
            </tbody>
          
          </table>
          <ul class="pagination justify-content-center">
                <li class="page-item">
                  <a class="page-link" href="javascript:void(0)" tabindex="-1" aria-label="Previous" id = "prev">
                    <span aria-hidden="true">
                      <i class="fa fa-angle-double-left"></i>
                    </span>
                    <span class="visually-hidden">Previous</span>
                  </a>
                </li>
                <li class="page-item">
                  <a class="page-link" id = "pageingBtn" href="javascript:void(0)">1</a>
                </li>
                <li class="page-item">
                  <a class="page-link" id = "pageingBtn" href="javascript:void(0)">2</a>
                </li>
                <li class="page-item">
                  <a class="page-link" id = "pageingBtn" href="javascript:void(0)">3</a>
                </li>
                <li class="page-item">
                  <a class="page-link" id = "pageingBtn" href="javascript:void(0)">4</a>
                </li>
                <li class="page-item">
                  <a class="page-link" href="javascript:void(0)" aria-label="Next" id = "next">
                    <span aria-hidden="true">
                      <i class="fa fa-angle-double-right"></i>
                    </span>
                    <span class="visually-hidden">Next</span>
                  </a>
                </li>
              </ul>
          <div class="d-flex justify-content-center">
            <div class="m-2">
              <input type="submit" class="btn btn-secondary" value="심사확인">
            </div>
            <div class="m-2">
              <input type="button" class="btn btn-secondary" onclick="javascript:ScholarReject();" value="심사거절">
            </div>      
        </div>
          </form>
        </div>
      </div>
    </div>
  </div>
  </div>
  <th:block th:if = "${message != null && message != ''}">
	<script th:inline="javascript">
		let message = /*[[${message}]]*/ 'default';
		alert(message);
		
	</script>
</th:block>
  <!-- Page JS Plugins -->
  <script th:src="@{/resources/assets/js/plugins/flatpickr/flatpickr.min.js}"></script>

  <!-- Page JS Helpers (Flatpickr + BS Datepicker + BS Maxlength + Select2 + Masked Inputs + Ion Range Slider + BS Colorpicker plugins) -->
  <script>One.helpersOnLoad(['js-flatpickr']);</script>
  


  <script>

      let btnCheckCnt = 0;

      document.querySelector("#allSelect").addEventListener('click', function(){
      document.querySelectorAll("[type = 'checkbox']").forEach(function(checkbox,idx){
        if(btnCheckCnt % 2 == 0){
          checkbox.checked= true
        }else{
          checkbox.checked = false
        }
        
      })
      btnCheckCnt++;
    })
   
    function ScholarReject(){
    	frm.action = "/tuna/admin/scholarReject";
    	frm.submit();
    }
    
document.addEventListener('DOMContentLoaded', function(){
		
		
		let nextBtn = document.querySelector("#next")
		let prevBtn = document.querySelector("#prev")
		let pageingBtn = document.querySelectorAll("#pageingBtn");
		nextBtn.addEventListener('click', function(){
			pageingBtn.forEach(btn =>{
				let a = btn.innerHTML
				btn.innerHTML = parseInt(a)+4;
			})
		})
		
		prevBtn.addEventListener('click', function(){
			pageingBtn.forEach(btn =>{
				let a = btn.innerHTML
				if (parseInt(a) > 4){
					btn.innerHTML = parseInt(a)-4;
				}
				
			})
		})
		
		pageingBtn.forEach(btn =>{
			btn.addEventListener('click',function(){
				let a = btn.innerHTML
				location.href = '/tuna/admin/adminScholarshipApplicationSearch?pageNum='+parseInt(a)
			})
		})
		
		
	})
    

  </script>
   <th:block th:if = "${params != null && params != ''}">
<script th:inline="javascript">
	document.addEventListener('DOMContentLoaded', function(){
		let params = /*[[${params}]]*/ 'default';
		
		 switch(params.year){
		 	case '108':
		 		$('#108').attr('selected', 'selected')
		 		break;
		 	case '107':
		 		$('#107').attr('selected', 'selected')
		 		break;
		 	case '106':
		 		$('#106').attr('selected', 'selected')
		 		break;
		 	case '105':
		 		$('#105').attr('selected', 'selected')
		 		break;
		 	case '104':
		 		$('#104').attr('selected', 'selected')
		 		break;
		 	case '103':
		 		$('#103').attr('selected', 'selected')
		 		break;
		 	case '102':
		 		$('#102').attr('selected', 'selected')
		 		break;
		 	case '101':
		 		$('#101').attr('selected', 'selected')
		 		break;
		 }
		 
		if(params.schno == '1'){
			$('#10').attr('selected', 'selected')
		}else if(params.schno == '2'){
			$('#11').attr('selected', 'selected')
		}else if(params.schno == '3'){
			$('#12').attr('selected', 'selected')
		}
		
		if(params.sy == '1'){
			$('#1').attr('selected', 'selected')
		}else if(params.sy == '2'){
			$('#2').attr('selected', 'selected')
		}else if(params.sy == '3'){
			$('#3').attr('selected', 'selected')
		}else if(params.sy == '4'){
			$('#4').attr('selected', 'selected')
		}
		
		if(params.schState == '501'){
			$('#501').attr('selected', 'selected')
		}else if(params.schState == '502'){
			$('#502').attr('selected', 'selected')
		}else if(params.schState == '503'){
			$('#503').attr('selected', 'selected')
		}else if(params.schState == '504'){
			$('#504').attr('selected', 'selected')
		}
		
		
		if(params.no != null){
			$('#no').val(params.no)
		}
		
		if(params.applydate != null){
			$('#applydate').val(params.applydate)
		}
		
		
	})
</script>
</th:block>
  
  
  </main>
  
</body>

</html>